<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NBA Edge System Dashboard</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
  
  :root {
    --navy: #0a0e27; --blue: #1a1f4e; --light-blue: #1e2454; --green: #00d4aa;
    --red: #ff4757; --orange: #ff8c42; --yellow: #ffd93d; --gray: #6c7293;
    --light-gray: #1a1f3a; --border: rgba(255,255,255,0.08); --white: #e8eaf6; --dark: #0d1117;
    --shadow: 0 8px 32px rgba(0,0,0,0.3); --purple: #a855f7; --teal: #00d4aa;
    --glass-bg: rgba(255,255,255,0.03); --glass-border: rgba(255,255,255,0.08);
    --glass-hover: rgba(255,255,255,0.06); --gradient-primary: linear-gradient(135deg, #00d4aa, #00b894);
    --gradient-accent: linear-gradient(135deg, #a855f7, #6366f1);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { 
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
    background: linear-gradient(135deg, #0a0e27 0%, #131833 50%, #0d1117 100%);
    color: #e8eaf6; line-height: 1.6; min-height: 100vh;
  }
  body::before {
    content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(0,212,170,0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(168,85,247,0.05) 0%, transparent 50%);
    pointer-events: none; z-index: 0;
  }

  .header {
    background: linear-gradient(135deg, rgba(10,14,39,0.95), rgba(26,31,78,0.95));
    backdrop-filter: blur(20px); color: white; padding: 18px 28px;
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid rgba(0,212,170,0.15); position: relative; z-index: 10;
    box-shadow: 0 4px 30px rgba(0,0,0,0.3);
  }
  .header h1 { font-size: 20px; font-weight: 700; letter-spacing: -0.3px; background: linear-gradient(135deg, #00d4aa, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .header-sub { font-size: 11px; opacity: 0.5; margin-top: 2px; font-weight: 400; }
  .header-right { display: flex; align-items: center; gap: 12px; }

  .btn { padding: 8px 18px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4,0,0.2,1); font-family: 'Inter', sans-serif; position: relative; overflow: hidden; }
  .btn-green { background: var(--gradient-primary); color: #0a0e27; box-shadow: 0 4px 15px rgba(0,212,170,0.25); }
  .btn-green:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(0,212,170,0.4); }
  .btn-red { background: linear-gradient(135deg, #ff4757, #ff3742); color: white; box-shadow: 0 4px 15px rgba(255,71,87,0.25); }
  .btn-red:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(255,71,87,0.4); }
  .btn-orange { background: linear-gradient(135deg, #ff8c42, #ff7b2e); color: white; box-shadow: 0 4px 15px rgba(255,140,66,0.25); }
  .btn-orange:hover { transform: translateY(-2px); }
  .btn-blue { background: var(--gradient-accent); color: white; box-shadow: 0 4px 15px rgba(168,85,247,0.25); }
  .btn-blue:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(168,85,247,0.4); }
  .btn:active { transform: translateY(0); }

  .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; animation: pulse-glow 2s infinite; }
  .status-dot.green { background: #00d4aa; box-shadow: 0 0 10px rgba(0,212,170,0.5); }
  .status-dot.red { background: #ff4757; box-shadow: 0 0 10px rgba(255,71,87,0.5); }
  @keyframes pulse-glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
  .connection-status { font-size: 12px; color: #6c7293; display: flex; align-items: center; font-weight: 500; }

  .tabs {
    display: flex; background: rgba(10,14,39,0.8); backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--glass-border); padding: 0 20px;
    position: sticky; top: 0; z-index: 100;
  }
  .tab {
    padding: 14px 22px; cursor: pointer; font-weight: 500; font-size: 13px;
    color: #6c7293; border-bottom: 2px solid transparent;
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1); position: relative;
    letter-spacing: 0.3px;
  }
  .tab:hover { color: #e8eaf6; background: rgba(255,255,255,0.03); }
  .tab.active { color: #00d4aa; border-bottom-color: #00d4aa; font-weight: 600; }
  .tab.active::after { content: ''; position: absolute; bottom: -1px; left: 20%; right: 20%; height: 2px; background: var(--gradient-primary); border-radius: 2px; filter: blur(4px); }
  .tab-badge { background: var(--gradient-primary); color: #0a0e27; font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 10px; margin-left: 6px; }

  .content { padding: 24px; position: relative; z-index: 1; max-width: 1400px; margin: 0 auto; }
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  .stat-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
  .stat-card {
    background: var(--glass-bg); backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border); border-radius: 16px;
    padding: 20px; text-align: center;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
    position: relative; overflow: hidden;
  }
  .stat-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: var(--gradient-primary); opacity: 0;
    transition: opacity 0.3s ease;
  }
  .stat-card:hover { transform: translateY(-4px); border-color: rgba(0,212,170,0.2); background: var(--glass-hover); box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
  .stat-card:hover::before { opacity: 1; }
  .stat-card .label { font-size: 11px; color: #6c7293; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; }
  .stat-card .value { font-size: 28px; font-weight: 800; margin-top: 6px; background: linear-gradient(135deg, #e8eaf6, #ffffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

  .game-card {
    background: var(--glass-bg); backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border); border-radius: 16px;
    padding: 18px; margin-bottom: 14px;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
    position: relative;
  }
  .game-card:hover { border-color: rgba(0,212,170,0.15); background: var(--glass-hover); transform: translateX(4px); box-shadow: 0 8px 30px rgba(0,0,0,0.2); }
  .game-card .game-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
  .game-card .teams { font-weight: 700; font-size: 15px; letter-spacing: -0.2px; }
  .game-card .score { font-size: 14px; color: #00d4aa; font-weight: 700; }
  .game-card .status { font-size: 12px; color: #a855f7; font-weight: 600; }
  .game-card .signals { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; }

  .signal-badge {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600;
    background: rgba(0,212,170,0.1); color: #00d4aa; border: 1px solid rgba(0,212,170,0.2);
    transition: all 0.3s ease;
  }
  .signal-badge:hover { background: rgba(0,212,170,0.2); transform: scale(1.05); }
  .signal-badge.hot { background: rgba(255,71,87,0.1); color: #ff4757; border-color: rgba(255,71,87,0.2); }
  .signal-badge.hot:hover { background: rgba(255,71,87,0.2); }

  .signal-panel {
    background: var(--glass-bg); backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border); border-radius: 16px;
    padding: 20px; margin-bottom: 20px;
  }
  .signal-panel h3 { font-size: 14px; font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
  .signal-list { display: flex; flex-direction: column; gap: 8px; }
  .signal-item { padding: 10px 14px; background: rgba(255,255,255,0.02); border-radius: 10px; font-size: 13px; border: 1px solid transparent; transition: all 0.3s ease; }
  .signal-item:hover { border-color: var(--glass-border); background: rgba(255,255,255,0.04); }

  table { width: 100%; border-collapse: separate; border-spacing: 0; background: var(--glass-bg); backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 16px; overflow: hidden; }
  th { background: linear-gradient(135deg, rgba(0,212,170,0.08), rgba(168,85,247,0.05)); color: #00d4aa; font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 1.2px; padding: 14px 16px; text-align: left; border-bottom: 1px solid var(--glass-border); }
  td { padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 13px; color: #c8cad8; transition: background 0.2s ease; }
  tr:hover td { background: rgba(255,255,255,0.02); }
  tr:last-child td { border-bottom: none; }

  .three-pt-card {
    background: var(--glass-bg); backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border); border-radius: 16px;
    padding: 18px; margin-bottom: 14px;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
  }
  .three-pt-card:hover { border-color: rgba(0,212,170,0.15); background: var(--glass-hover); transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.2); }
  .three-pt-card .team-name { font-weight: 700; font-size: 15px; }
  .three-pt-card .pct { font-size: 22px; font-weight: 800; color: #00d4aa; }
  .three-pt-card .details { font-size: 12px; color: #6c7293; margin-top: 4px; }

  .quarter-box {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600;
    background: rgba(0,212,170,0.08); color: #00d4aa; border: 1px solid rgba(0,212,170,0.15);
    margin: 2px 4px; transition: all 0.3s ease;
  }
  .quarter-box:hover { background: rgba(0,212,170,0.15); }

  .thesis-card, .edge-card {
    background: var(--glass-bg); backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border); border-radius: 16px;
    padding: 20px; margin-bottom: 16px;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
  }
  .thesis-card:hover, .edge-card:hover { border-color: rgba(168,85,247,0.2); background: var(--glass-hover); }
  .thesis-card h3, .edge-card h3 { font-size: 15px; font-weight: 700; margin-bottom: 10px; color: #e8eaf6; }

  .modal-overlay { display: none;
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(10,14,39,0.85); backdrop-filter: blur(8px);
    display: flex; align-items: center; justify-content: center;
    z-index: 1000; animation: fadeIn 0.3s ease;
  }
  .modal-overlay.active { display: flex; }
  .modal {
    background: linear-gradient(135deg, #131833, #1a1f4e);
    border: 1px solid var(--glass-border); border-radius: 20px;
    padding: 28px; max-width: 500px; width: 90%;
    box-shadow: 0 25px 60px rgba(0,0,0,0.5);
  }
  .modal h2 { font-size: 18px; font-weight: 700; margin-bottom: 16px; background: linear-gradient(135deg, #00d4aa, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

  input[type="text"], input[type="number"], input[type="date"], select, textarea {
    background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
    color: #e8eaf6; padding: 10px 14px; border-radius: 10px; font-size: 13px;
    font-family: 'Inter', sans-serif; transition: all 0.3s ease; width: 100%;
  }
  input:focus, select:focus, textarea:focus { outline: none; border-color: rgba(0,212,170,0.4); box-shadow: 0 0 20px rgba(0,212,170,0.1); background: rgba(255,255,255,0.08); }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

  .bankroll-section { background: var(--glass-bg); backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
  .bankroll-section h3 { font-size: 15px; font-weight: 700; margin-bottom: 14px; }
  .bankroll-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; }

  #demo-btn {
    background: linear-gradient(135deg, #a855f7, #6366f1) !important;
    color: white !important; border-radius: 8px !important;
    font-weight: 600 !important; box-shadow: 0 4px 15px rgba(168,85,247,0.3);
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1) !important;
  }
  #demo-btn:hover { transform: translateY(-2px) !important; box-shadow: 0 6px 25px rgba(168,85,247,0.5) !important; }
  #sound-toggle {
    background: rgba(255,255,255,0.05) !important;
    border: 1px solid var(--glass-border) !important; border-radius: 8px !important;
    color: #e8eaf6 !important; font-weight: 500 !important;
    transition: all 0.3s ease !important;
  }
  #sound-toggle:hover { background: rgba(255,255,255,0.1) !important; }

  .toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 8px; }
  .toast {
    padding: 12px 20px; border-radius: 12px; font-size: 13px; font-weight: 500;
    animation: slideInRight 0.4s cubic-bezier(0.4,0,0.2,1);
    backdrop-filter: blur(12px); border: 1px solid var(--glass-border);
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  }
  .toast.green { background: rgba(0,212,170,0.15); color: #00d4aa; border-color: rgba(0,212,170,0.2); }
  .toast.red { background: rgba(255,71,87,0.15); color: #ff4757; border-color: rgba(255,71,87,0.2); }
  .toast.orange { background: rgba(255,140,66,0.15); color: #ff8c42; border-color: rgba(255,140,66,0.2); }
  @keyframes slideInRight { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

  .no-games { text-align: center; padding: 60px 20px; color: #6c7293; font-size: 15px; }
  .refresh-timer { font-size: 11px; color: #6c7293; font-weight: 500; }
  .game-grid { display: grid; gap: 14px; }

  .edge-analysis { background: var(--glass-bg); backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 16px; padding: 18px; margin-top: 10px; }
  .edge-analysis h4 { font-size: 13px; font-weight: 700; color: #a855f7; margin-bottom: 8px; }
  .verdict { padding: 10px 14px; border-radius: 10px; font-weight: 600; font-size: 13px; margin-top: 8px; background: rgba(0,212,170,0.08); border: 1px solid rgba(0,212,170,0.15); color: #00d4aa; }
  .verdict.negative { background: rgba(255,71,87,0.08); border-color: rgba(255,71,87,0.15); color: #ff4757; }

  .star-card { background: var(--glass-bg); backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 16px; padding: 18px; margin-bottom: 14px; transition: all 0.4s cubic-bezier(0.4,0,0.2,1); }
  .star-card:hover { border-color: rgba(168,85,247,0.2); background: var(--glass-hover); transform: translateY(-2px); }
  .star-name { font-weight: 700; font-size: 16px; }
  .star-ppg { color: #a855f7; font-weight: 700; }
  .pace-bar { height: 6px; background: rgba(255,255,255,0.08); border-radius: 3px; overflow: hidden; margin-top: 8px; }
  .pace-fill { height: 100%; border-radius: 3px; background: var(--gradient-primary); transition: width 0.6s cubic-bezier(0.4,0,0.2,1); }

  .bet-log-table { margin-top: 16px; }
  .export-btn { margin-top: 12px; }

  @media (max-width: 768px) {
    .content { padding: 16px; }
    .stat-cards { grid-template-columns: 1fr 1fr; }
    .tabs { overflow-x: auto; }
    .tab { padding: 12px 16px; font-size: 12px; white-space: nowrap; }
  }


  
  /* === LAYOUT FIX - Matching actual HTML class names === */
  .tab-bar {
    display: flex; background: rgba(10,14,39,0.8); backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(255,255,255,0.08); padding: 0 20px;
    position: sticky; top: 0; z-index: 100;
  }
  .stats-row {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;
  }
  .stat-card {
    background: rgba(255,255,255,0.03); backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.08); border-radius: 16px;
    padding: 20px; text-align: center;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1); position: relative; overflow: hidden;
  }
  .stat-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(135deg, #00d4aa, #00b894); opacity: 0; transition: opacity 0.3s ease;
  }
  .stat-card:hover { transform: translateY(-4px); border-color: rgba(0,212,170,0.2); background: rgba(255,255,255,0.06); box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
  .stat-card:hover::before { opacity: 1; }
  .stat-label { font-size: 11px; color: #6c7293; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; }
  .stat-value { font-size: 28px; font-weight: 800; margin-top: 6px; background: linear-gradient(135deg, #e8eaf6, #ffffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .card {
    background: rgba(255,255,255,0.03); backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.08); border-radius: 16px;
    padding: 18px; margin-bottom: 14px;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
  }
  .card:hover { border-color: rgba(0,212,170,0.15); background: rgba(255,255,255,0.06); transform: translateX(4px); box-shadow: 0 8px 30px rgba(0,0,0,0.2); }
  .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: 700; }
  .card-body { font-size: 13px; color: #c8cad8; }
  .games-grid { display: grid; gap: 14px; }
  .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; }
  .empty-state { text-align: center; padding: 60px 20px; color: #6c7293; font-size: 15px; }

  /* ==================== LIVE SCENARIO ALERTS ==================== */
    .scenario-alert-panel { position: fixed; top: 80px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; max-width: 420px; pointer-events: none; }
    .scenario-alert { pointer-events: all; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 2px solid var(--orange); border-radius: 12px; padding: 16px; color: white; box-shadow: 0 8px 32px rgba(253, 126, 20, 0.3); animation: alertSlideIn 0.5s ease-out, alertPulse 2s ease-in-out 0.5s; position: relative; overflow: hidden; }
    .scenario-alert::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--orange), var(--red), var(--orange)); animation: alertGlow 1.5s ease-in-out infinite; }
    .scenario-alert .alert-dismiss { position: absolute; top: 8px; right: 10px; background: none; border: none; color: rgba(255,255,255,0.5); cursor: pointer; font-size: 16px; padding: 2px 6px; }
    .scenario-alert .alert-dismiss:hover { color: white; }
    .scenario-alert .alert-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .scenario-alert .alert-badge { background: var(--red); color: white; padding: 3px 10px; border-radius: 20px; font-size: 10px; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; animation: badgePulse 1s ease-in-out infinite; }
    .scenario-alert .alert-game-time { font-size: 11px; color: rgba(255,255,255,0.6); }
    .scenario-alert .alert-player { font-size: 20px; font-weight: 800; margin-bottom: 4px; }
    .scenario-alert .alert-team { font-size: 12px; color: var(--orange); font-weight: 600; margin-bottom: 12px; }
    .scenario-alert .alert-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
    .scenario-alert .alert-stat { background: rgba(255,255,255,0.08); border-radius: 8px; padding: 8px; text-align: center; }
    .scenario-alert .alert-stat-label { font-size: 9px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px; }
    .scenario-alert .alert-stat-value { font-size: 18px; font-weight: 800; margin-top: 2px; }
    .scenario-alert .alert-stat-value.cold { color: #4fc3f7; }
    .scenario-alert .alert-stat-value.hot { color: var(--red); }
    .scenario-alert .alert-stat-value.neutral { color: var(--orange); }
    .scenario-alert .alert-pace-bar { background: rgba(255,255,255,0.1); border-radius: 6px; height: 8px; margin-bottom: 8px; overflow: hidden; position: relative; }
    .scenario-alert .alert-pace-fill { height: 100%; border-radius: 6px; transition: width 0.5s ease; }
    .scenario-alert .alert-pace-marker { position: absolute; top: -2px; bottom: -2px; width: 2px; background: white; border-radius: 1px; }
    .scenario-alert .alert-verdict { font-size: 12px; color: rgba(255,255,255,0.8); line-height: 1.5; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
    .scenario-alert .alert-verdict strong { color: var(--orange); }
    .scenario-alert .alert-action { margin-top: 8px; display: flex; gap: 8px; }
    @keyframes alertSlideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes alertPulse { 0%, 100% { box-shadow: 0 8px 32px rgba(253, 126, 20, 0.3); } 50% { box-shadow: 0 8px 48px rgba(253, 126, 20, 0.5); } }
    @keyframes alertGlow { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
    @keyframes badgePulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    .demo-btn { background: linear-gradient(135deg, var(--purple), var(--blue)); color: white; border: none; padding: 6px 14px; border-radius: 6px; font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.2s; }
    .demo-btn:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(111, 66, 193, 0.4); }
    .sound-toggle { background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; cursor: pointer; }
    .sound-toggle:hover { border-color: white; }
    .sound-toggle.active { background: var(--green); border-color: var(--green); }

    </style>
</head>
<body>

<div class="header">
  <div>
    <h1>NBA EDGE SYSTEM</h1>
    <div class="header-sub">Live ML Edge Finder &bull; 3PT / Star Pace / Paint Durability / Fouls &bull; Auto-Updating</div>
  </div>
  <div class="header-right">
    <span class="conn-status conn-ok" id="connStatus" style="display:none;">Connected</span>
    <div>
      <span class="status-dot off" id="statusDot"></span>
      <span id="statusText" style="font-size:11px;">ESPN Feed</span>
    </div><button class="sound-toggle" id="soundToggle" onclick="toggleSound()" title="Toggle alert sounds">&#x1F50A; Sound</button><button class="demo-btn" onclick="runDemoScenario()" title="Simulate a live game scenario">&#x1F3AE; Demo</button>
  </div>
</div>

<div class="tab-bar">
  <div class="tab active" onclick="switchTab('live')" id="tab-live">Live Games <span class="badge" id="live-badge" style="display:none;">0</span></div>
  <div class="tab" onclick="switchTab('threept')" id="tab-threept">3PT Tracker <span class="badge badge-purple" id="threept-badge" style="display:none;">0</span></div>
  <div class="tab" onclick="switchTab('stars')" id="tab-stars">Star Tracker</div>
  <div class="tab" onclick="switchTab('log')" id="tab-log">Bet Log</div>
  <div class="tab" onclick="switchTab('bankroll')" id="tab-bankroll">Bankroll</div>
</div>

<div class="container">
  <div id="quarter-alerts"></div>

  <!-- ==================== LIVE GAMES TAB ==================== -->
  <div class="tab-content active" id="content-live">
    <!-- EDGE THESIS PANEL -->
    <div class="edge-thesis-container" id="edgeThesisContainer">
      <div class="edge-thesis-header">
        <h2>LIVE EDGE OPPORTUNITIES</h2>
        <span class="thesis-count" id="thesisCount">0</span>
      </div>
      <div id="edgeThesisCards"></div>
    </div>

    <div class="auto-refresh-bar">
      <span class="dot" id="autoRefreshDot"></span>
      <span>Auto-refresh: <strong id="autoRefreshLabel">OFF</strong></span>
      <button class="btn btn-sm btn-green" id="autoRefreshBtn" onclick="toggleAutoRefresh()">Start</button>
      <span style="margin-left:6px;">Every:</span>
      <select id="refreshInterval" style="padding:2px 6px;font-size:11px;border-radius:4px;border:1px solid var(--border);" onchange="updateRefreshInterval()">
        <option value="30">30s</option>
        <option value="60" selected>60s</option>
        <option value="120">2min</option>
      </select>
      <div class="countdown-bar"><div class="countdown-fill" id="countdownFill" style="width:100%;"></div></div>
      <span style="margin-left:auto;color:var(--gray);font-size:10px;">Last: <span id="live-last-update">-</span> | Errors: <span id="errorCount">0</span></span>
    </div>

    <div class="stats-row">
      <div class="stat-card"><div class="stat-label">Live Games</div><div class="stat-value" id="live-games-count">-</div></div>
      <div class="stat-card"><div class="stat-label">3PT Signals</div><div class="stat-value orange" id="live-3pt-signals">0</div></div>
      <div class="stat-card"><div class="stat-label">Star Cold</div><div class="stat-value orange" id="live-star-signals">0</div></div>
      <div class="stat-card"><div class="stat-label">Fragile Leads</div><div class="stat-value teal" id="live-fragile-leads">0</div></div>
      <div class="stat-card"><div class="stat-label">Combined</div><div class="stat-value red" id="live-combined-signals">0</div></div>
    </div>

    <div class="card">
      <div class="card-header"><span>Live Game Monitor</span>
        <button class="btn btn-green btn-sm" onclick="fetchESPNScoreboard()">Refresh Now</button>
      </div>
      <div class="card-body">
        <div class="games-grid" id="live-games-grid">
          <div class="empty-state" style="grid-column:1/-1;"><div class="icon">&#x1F3C0;</div><p>Click "Refresh Now" or start auto-refresh to load live games.</p></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== 3PT TRACKER TAB ==================== -->
  <div class="tab-content" id="content-threept">
    <div class="stats-row">
      <div class="stat-card"><div class="stat-label">Teams 50%+ 3PT</div><div class="stat-value red" id="threept-hot-count">0</div></div>
      <div class="stat-card"><div class="stat-label">Teams 45-50%</div><div class="stat-value orange" id="threept-warm-count">0</div></div>
      <div class="stat-card"><div class="stat-label">Qtr Alerts</div><div class="stat-value purple" id="threept-qtr-alerts">0</div></div>
      <div class="stat-card"><div class="stat-label">League Avg</div><div class="stat-value" style="color:var(--blue);">36.5%</div></div>
    </div>
    <div class="card">
      <div class="card-header"><span>3-Point Shooting Tracker - Live</span><span style="font-size:10px;color:var(--gray);">Alert: 50%+ on 8+ att</span></div>
      <div class="card-body"><div class="games-grid" id="threept-grid"><div class="empty-state" style="grid-column:1/-1;"><div class="icon">&#x1F3AF;</div><p>3PT tracking populates when live games run.</p></div></div></div>
    </div>
    <div class="card">
      <div class="card-header"><span>Quarter-End Alerts</span><button class="btn btn-sm btn-outline" onclick="clearQtrAlerts()">Clear</button></div>
      <div class="card-body">
        <table><thead><tr><th>Time</th><th>Team</th><th>Qtr</th><th>3PT%</th><th>Made/Att</th><th>Game</th><th>Action</th></tr></thead>
        <tbody id="qtr-alerts-body"><tr><td colspan="7" class="empty-state">No quarter-end alerts yet.</td></tr></tbody></table>
      </div>
    </div>
  </div>

  <!-- ==================== STAR TRACKER TAB ==================== -->
  <div class="tab-content" id="content-stars">
    <div class="card">
      <div class="card-header"><span>Star Player Database (23+ PPG)</span><span style="font-size:10px;color:var(--gray);">Signal: &lt;60% of expected pace</span></div>
      <div class="card-body" style="font-size:12px;">
        <p style="margin-bottom:10px;color:var(--gray);">Players tracked automatically in live games. Signal fires when scoring falls below 60% of expected pace. Tracks Q1 and halftime pace separately.</p>
        <table>
          <thead><tr><th>Player</th><th>Team</th><th>PPG</th><th>Q1 Exp</th><th>Half Exp</th><th>Signal (&lt;60%)</th><th></th></tr></thead>
          <tbody id="star-db-body"></tbody>
        </table>
        <div style="margin-top:10px;">
          <div class="form-grid" style="max-width:700px;">
            <div class="form-group"><label>Player Name</label><input type="text" id="add-star-name" placeholder="e.g., LeBron James" /></div>
            <div class="form-group"><label>Team</label><input type="text" id="add-star-team" placeholder="e.g., LAL" /></div>
            <div class="form-group"><label>PPG</label><input type="number" id="add-star-ppg" placeholder="e.g., 28.5" step="0.1" /></div>
            <div class="form-group" style="justify-content:flex-end;"><button class="btn btn-green" onclick="addStar()">Add</button></div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">Live Star Status</div>
      <div class="card-body">
        <table><thead><tr><th>Player</th><th>Game</th><th>Pts</th><th>Q1 Pace</th><th>Half Pace</th><th>Overall %</th><th>Period</th><th>Signal</th></tr></thead>
        <tbody id="live-star-status"><tr><td colspan="8" class="empty-state">Star stats populate when live games are running.</td></tr></tbody></table>
      </div>
    </div>
  </div>

  <!-- ==================== BET LOG TAB ==================== -->
  <div class="tab-content" id="content-log">
    <div class="stats-row">
      <div class="stat-card"><div class="stat-label">Total Bets</div><div class="stat-value" id="log-total">0</div></div>
      <div class="stat-card"><div class="stat-label">Win Rate</div><div class="stat-value" id="log-winrate">-</div></div>
      <div class="stat-card"><div class="stat-label">Net Units</div><div class="stat-value" id="log-net-units">0</div></div>
      <div class="stat-card"><div class="stat-label">ROI</div><div class="stat-value" id="log-roi">-</div></div>
      <div class="stat-card"><div class="stat-label">Streak</div><div class="stat-value" id="log-streak">-</div></div>
    </div>
    <div class="card">
      <div class="card-header"><span>All Bets</span><div><button class="btn btn-outline btn-sm" onclick="exportLog()">Export CSV</button> <button class="btn btn-red btn-sm" onclick="clearLog()">Clear All</button></div></div>
      <div class="card-body">
        <table><thead><tr><th>Date</th><th>Strategy</th><th>Game</th><th>Side</th><th>Line</th><th>Units</th><th>Result</th><th>Profit</th><th>Actions</th></tr></thead>
        <tbody id="bet-log-body"><tr><td colspan="9" class="empty-state">No bets logged yet.</td></tr></tbody></table>
      </div>
    </div>
  </div>

  <!-- ==================== BANKROLL TAB ==================== -->
  <div class="tab-content" id="content-bankroll">
    <div class="card">
      <div class="card-header">Bankroll Settings</div>
      <div class="card-body">
        <div class="form-grid" style="max-width:500px;">
          <div class="form-group"><label>Starting ($)</label><input type="number" id="bankroll-start" placeholder="1000" onchange="updateBankroll()" /></div>
          <div class="form-group"><label>Current ($)</label><input type="number" id="bankroll-current" placeholder="1050" onchange="updateBankroll()" /></div>
        </div>
      </div>
    </div>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-label">1 Unit (1%)</div><div class="stat-value" id="br-unit">-</div></div>
      <div class="stat-card"><div class="stat-label">Max (2%)</div><div class="stat-value" id="br-max">-</div></div>
      <div class="stat-card"><div class="stat-label">Daily (5u)</div><div class="stat-value" id="br-daily">-</div></div>
      <div class="stat-card"><div class="stat-label">P/L</div><div class="stat-value" id="br-pl">-</div></div>
      <div class="stat-card"><div class="stat-label">P/L %</div><div class="stat-value" id="br-pl-pct">-</div></div>
    </div>
    <div class="card">
      <div class="card-header">Rules</div>
      <div class="card-body" style="font-size:13px;line-height:1.8;">
        <p><strong>Standard:</strong> 1u &bull; <strong>High conviction:</strong> 1.5u &bull; <strong>Max:</strong> 2u</p>
        <p style="margin-top:6px;padding:8px;background:#fff3cd;border-radius:6px;font-size:12px;"><strong>Stop-loss:</strong> 3 straight L = 1 day off. 20% drawdown = cut to 0.5% units.</p>
      </div>
    </div>
  </div>
</div>

<!-- LOG BET MODAL -->
<div class="modal-overlay" id="logModal">
  <div class="modal">
    <h3>Log This Bet</h3>
    <div class="form-grid">
      <div class="form-group"><label>Game</label><input type="text" id="modal-game" /></div>
      <div class="form-group"><label>Side</label><input type="text" id="modal-side" /></div>
      <div class="form-group"><label>Strategy</label><select id="modal-strategy"><option>Mean Reversion</option><option>3PT Regression</option><option>Paint Durability</option><option>Foul Trouble</option></select></div>
      <div class="form-group"><label>Line / Price</label><input type="text" id="modal-price" /></div>
      <div class="form-group"><label>Units</label><input type="number" id="modal-units" value="1" step="0.5" min="0.5" max="2" /></div>
      <div class="form-group"><label>Notes</label><input type="text" id="modal-notes" /></div>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-green" onclick="confirmLogBet()">Log Bet</button>
    </div>
  </div>
</div>


  <div id="scenario-alert-panel" class="scenario-alert-panel"></div>

  <div id="toast-container" style="position:fixed;top:70px;right:20px;z-index:150;display:flex;flex-direction:column;gap:6px;"></div>

<script>
// ==================== STAR DATABASE (23+ PPG) ====================
const DEFAULT_STARS = [
  { name: "Shai Gilgeous-Alexander", team: "OKC", ppg: 32.2 },
  { name: "Giannis Antetokounmpo", team: "MIL", ppg: 31.5 },
  { name: "Nikola Jokic", team: "DEN", ppg: 29.0 },
  { name: "Luka Doncic", team: "DAL", ppg: 28.1 },
  { name: "Jayson Tatum", team: "BOS", ppg: 27.8 },
  { name: "Joel Embiid", team: "PHI", ppg: 27.6 },
  { name: "Kevin Durant", team: "PHX", ppg: 27.3 },
  { name: "Devin Booker", team: "PHX", ppg: 27.2 },
  { name: "Anthony Edwards", team: "MIN", ppg: 27.0 },
  { name: "De'Aaron Fox", team: "SAC", ppg: 26.8 },
  { name: "Donovan Mitchell", team: "CLE", ppg: 26.5 },
  { name: "Jalen Brunson", team: "NYK", ppg: 26.3 },
  { name: "Anthony Davis", team: "LAL", ppg: 25.7 },
  { name: "Tyrese Maxey", team: "PHI", ppg: 25.5 },
  { name: "Karl-Anthony Towns", team: "NYK", ppg: 25.3 },
  { name: "Cade Cunningham", team: "DET", ppg: 24.8 },
  { name: "Trae Young", team: "ATL", ppg: 24.3 },
  { name: "Damian Lillard", team: "MIL", ppg: 24.0 },
  { name: "Jaylen Brown", team: "BOS", ppg: 23.8 },
  { name: "LeBron James", team: "LAL", ppg: 23.5 },
  { name: "Jaren Jackson Jr.", team: "MEM", ppg: 23.3 },
  { name: "Tyrese Haliburton", team: "IND", ppg: 23.2 },
  { name: "Zion Williamson", team: "NOP", ppg: 23.0 },
];

const TEAM_MAP = {
  'Atlanta Hawks':'ATL','Boston Celtics':'BOS','Brooklyn Nets':'BKN','Charlotte Hornets':'CHA',
  'Chicago Bulls':'CHI','Cleveland Cavaliers':'CLE','Dallas Mavericks':'DAL','Denver Nuggets':'DEN',
  'Detroit Pistons':'DET','Golden State Warriors':'GSW','Houston Rockets':'HOU','Indiana Pacers':'IND',
  'LA Clippers':'LAC','Los Angeles Clippers':'LAC','Los Angeles Lakers':'LAL','Memphis Grizzlies':'MEM',
  'Miami Heat':'MIA','Milwaukee Bucks':'MIL','Minnesota Timberwolves':'MIN','New Orleans Pelicans':'NOP',
  'New York Knicks':'NYK','Oklahoma City Thunder':'OKC','Orlando Magic':'ORL','Philadelphia 76ers':'PHI',
  'Phoenix Suns':'PHX','Portland Trail Blazers':'POR','Sacramento Kings':'SAC','San Antonio Spurs':'SAS',
  'Toronto Raptors':'TOR','Utah Jazz':'UTA','Washington Wizards':'WAS',
};
function shortName(n) { return TEAM_MAP[n] || n.split(' ').pop().substring(0,3).toUpperCase(); }

// ==================== STATE ====================
let state = {
  betLog: JSON.parse(localStorage.getItem('betLog') || '[]'),
  bankroll: JSON.parse(localStorage.getItem('bankroll') || '{"start":0,"current":0}'),
  stars: JSON.parse(localStorage.getItem('starPlayers') || 'null') || DEFAULT_STARS,
  autoRefresh: false, refreshTimer: null, countdownTimer: null,
  quarterAlerts: JSON.parse(localStorage.getItem('quarterAlerts') || '[]'),
  lastKnownPeriods: {}, prevTeamData: {},
  errorCount: 0, consecutiveErrors: 0,
};

// ==================== INIT ====================
document.getElementById('bankroll-start').value = state.bankroll.start || '';
document.getElementById('bankroll-current').value = state.bankroll.current || '';
updateBankroll(); renderBetLog(); renderStarDB(); renderQtrAlerts();

// ==================== TABS ====================
function switchTab(t) {
  document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
  document.getElementById('tab-'+t).classList.add('active');
  document.getElementById('content-'+t).classList.add('active');
}

// ==================== AUTO REFRESH ====================
function toggleAutoRefresh() {
  state.autoRefresh = !state.autoRefresh;
  const btn = document.getElementById('autoRefreshBtn'), dot = document.getElementById('autoRefreshDot'), lbl = document.getElementById('autoRefreshLabel');
  if (state.autoRefresh) {
    btn.textContent = 'Stop'; btn.className = 'btn btn-sm btn-red'; dot.className = 'dot'; lbl.textContent = 'ON';
    fetchESPNScoreboard(); startCountdown();
  } else {
    btn.textContent = 'Start'; btn.className = 'btn btn-sm btn-green'; dot.className = 'dot off'; lbl.textContent = 'OFF';
    clearInterval(state.refreshTimer); clearInterval(state.countdownTimer);
    document.getElementById('countdownFill').style.width = '100%';
  }
}
function startCountdown() {
  const iv = parseInt(document.getElementById('refreshInterval').value) * 1000;
  let rem = iv;
  clearInterval(state.refreshTimer); clearInterval(state.countdownTimer);
  state.refreshTimer = setInterval(() => { if (state.autoRefresh) { fetchESPNScoreboard(); rem = iv; } }, iv);
  state.countdownTimer = setInterval(() => { rem -= 1000; document.getElementById('countdownFill').style.width = Math.max(0, rem/iv*100)+'%'; }, 1000);
}
function updateRefreshInterval() { if (state.autoRefresh) startCountdown(); }

// ==================== PACE HELPERS ====================
function getQ1Expected(ppg) { return ppg * 0.25; }
function getHalfExpected(ppg) { return ppg * 0.5; }
function getExpectedByTime(ppg, mins) { return ppg * (mins / 48); }

// ==================== CONNECTION STATUS ====================
function setConnStatus(status) {
  const el = document.getElementById('connStatus');
  const dot = document.getElementById('statusDot');
  el.style.display = 'inline';
  if (status === 'ok') { el.textContent = 'Connected'; el.className = 'conn-status conn-ok'; dot.className = 'status-dot live'; state.consecutiveErrors = 0; }
  else if (status === 'error') { el.textContent = 'Error'; el.className = 'conn-status conn-err'; dot.className = 'status-dot error'; state.consecutiveErrors++; state.errorCount++; }
  else { el.textContent = 'Loading...'; el.className = 'conn-status conn-loading'; }
  document.getElementById('errorCount').textContent = state.errorCount;
}

// ==================== QUARTER-END DETECTION ====================
function checkQuarterEnd(gameId, teamAbbr, currentPeriod, pct, made, att, gameLabel) {
  const key = `${gameId}_${teamAbbr}`;
  const prev = state.lastKnownPeriods[key] || 0;
  if (currentPeriod > prev && prev > 0) {
    const p = state.prevTeamData[key];
    if (p) {
      const qM = (parseInt(made)||0) - (p.made||0), qA = (parseInt(att)||0) - (p.att||0);
      const qP = qA > 0 ? (qM/qA*100) : 0;
      if (qP >= 50 && qA >= 4) {
        const a = { id: Date.now()+Math.random(), time: new Date().toLocaleTimeString(), team: teamAbbr, quarter: prev, pct: qP.toFixed(1), made: qM, att: qA, game: gameLabel };
        state.quarterAlerts.unshift(a); localStorage.setItem('quarterAlerts', JSON.stringify(state.quarterAlerts));
        renderQtrAlerts(); showQuarterToast(a);
      }
    }
  }
  state.lastKnownPeriods[key] = currentPeriod;
  state.prevTeamData[key] = { made: parseInt(made)||0, att: parseInt(att)||0, period: currentPeriod };
}

function showQuarterToast(a) {
  const c = document.getElementById('toast-container'), t = document.createElement('div');
  t.className = 'quarter-alert-toast';
  t.innerHTML = `<div class="toast-title">Q${a.quarter} END - ${a.team}</div><div class="toast-body">${a.team} shot ${a.pct}% from 3 (${a.made}/${a.att}) in Q${a.quarter}! ${a.game}</div>`;
  t.onclick = () => t.remove(); c.appendChild(t);
  setTimeout(() => { if (t.parentNode) t.remove(); }, 11000);
  const badge = document.getElementById('threept-badge');
  if (state.quarterAlerts.length > 0) { badge.style.display = 'inline'; badge.textContent = state.quarterAlerts.length; }
}

function renderQtrAlerts() {
  const tb = document.getElementById('qtr-alerts-body');
  if (!state.quarterAlerts.length) { tb.innerHTML = '<tr><td colspan="7" class="empty-state">No quarter-end alerts yet.</td></tr>'; document.getElementById('threept-qtr-alerts').textContent = '0'; return; }
  tb.innerHTML = state.quarterAlerts.map(a => `<tr><td>${a.time}</td><td><strong>${a.team}</strong></td><td>Q${a.quarter}</td><td style="color:var(--red);font-weight:800;">${a.pct}%</td><td>${a.made}/${a.att}</td><td>${a.game}</td><td><button class="btn btn-purple btn-sm" onclick="openLogModal('${a.game}','3PT Q${a.quarter}','3PT Regression')">Log</button></td></tr>`).join('');
  document.getElementById('threept-qtr-alerts').textContent = state.quarterAlerts.length;
}
function clearQtrAlerts() { if(confirm('Clear all?')) { state.quarterAlerts=[]; localStorage.setItem('quarterAlerts','[]'); renderQtrAlerts(); document.getElementById('threept-badge').style.display='none'; } }

// ==================== LEAD DURABILITY (PAINT vs 3PT) ====================
function analyzeScoringDurability(teamAbbr, score, fg3Made, opponentScore) {
  const s = parseInt(score) || 0;
  const m3 = parseInt(fg3Made) || 0;
  if (s <= 0) return { pct3: 0, durability: 'neutral', label: '-', fragile: false };
  const pts3 = m3 * 3;
  const pct3 = (pts3 / s * 100);
  const nonThreePts = s - pts3;
  // League average: ~35% of points come from 3PT. Above 42% is fragile, below 28% is durable
  const isLeading = s > (parseInt(opponentScore) || 0);
  const fragile = pct3 >= 42 && isLeading && s >= 20;
  const durable = pct3 <= 28 && isLeading && s >= 20;
  let label = `${pct3.toFixed(0)}% from 3`;
  let durability = 'neutral';
  if (fragile) { durability = 'fragile'; label = `${pct3.toFixed(0)}% from 3 - FRAGILE lead`; }
  else if (durable) { durability = 'durable'; label = `${pct3.toFixed(0)}% from 3 - DURABLE lead`; }
  return { pct3, durability, label, fragile, durable, pts3, nonThreePts };
}

// ==================== FOUL TRACKING ====================
function analyzeTeamFouls(fouls, period, clock) {
  const f = parseInt(fouls) || 0;
  const clockMin = parseFloat(clock?.split(':')[0] || 12);
  const minsPlayed = (period - 1) * 12 + (12 - clockMin);
  const foulRate = minsPlayed > 0 ? (f / minsPlayed * 12) : 0; // fouls per quarter rate
  // NBA average: ~5 fouls per quarter. High foul rate = bonus free throws = inflated scoring
  const highFouls = foulRate >= 6.5 && f >= 10;
  return { fouls: f, foulRate: foulRate.toFixed(1), highFouls, perQtr: foulRate.toFixed(1) };
}

// ==================== ESPN SCOREBOARD ====================
async function fetchESPNScoreboard() {
  const grid = document.getElementById('live-games-grid');
  const tpGrid = document.getElementById('threept-grid');
  setConnStatus('loading');

  try {
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 10000);
    const res = await fetch('https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard', { signal: controller.signal });
    clearTimeout(timeout);
    if (!res.ok) throw new Error('ESPN ' + res.status);
    const data = await res.json();
    setConnStatus('ok');
    const events = data.events || [];
    document.getElementById('live-last-update').textContent = new Date().toLocaleTimeString();

    const liveEvents = events.filter(e => { const s = e.status?.type?.state; return s === 'in' || s === 'pre'; });
    const inProgress = events.filter(e => e.status?.type?.state === 'in');
    document.getElementById('live-games-count').textContent = inProgress.length;

    if (liveEvents.length === 0) {
      grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><div class="icon">&#x1F3C0;</div><p>No live or upcoming NBA games right now.</p></div>`;
      tpGrid.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><div class="icon">&#x1F3AF;</div><p>No live games.</p></div>`;
      document.getElementById('edgeThesisContainer').classList.remove('active');
      return;
    }

    let sig3=0, sigStar=0, sigCombined=0, sigFragile=0, hotTeams=0, warmTeams=0;
    let cards='', tpCards='', gameTheses=[];

    for (const event of liveEvents) {
      const comp = event.competitions?.[0]; if (!comp) continue;
      const away = comp.competitors?.find(c => c.homeAway==='away');
      const home = comp.competitors?.find(c => c.homeAway==='home');
      if (!away || !home) continue;

      const gid = event.id;
      const aA = away.team?.abbreviation || shortName(away.team?.displayName||'');
      const hA = home.team?.abbreviation || shortName(home.team?.displayName||'');
      const aS = parseInt(away.score)||0, hS = parseInt(home.score)||0;
      const isLive = event.status?.type?.state === 'in';
      const per = event.status?.period||0, clk = event.status?.displayClock||'';
      const detail = event.status?.type?.shortDetail||'';
      const gLabel = `${aA} @ ${hA}`;
      const aRec = away.records?.[0]?.summary||'', hRec = home.records?.[0]?.summary||'';

      let aStats={}, hStats={};
      (away.statistics||[]).forEach(s => { aStats[s.name]=s.displayValue; });
      (home.statistics||[]).forEach(s => { hStats[s.name]=s.displayValue; });

      let a3P=aStats.threePointFieldGoalPct||aStats.threePointPct||'-';
      let h3P=hStats.threePointFieldGoalPct||hStats.threePointPct||'-';
      let a3M=aStats.threePointFieldGoalsMade||'-', a3A=aStats.threePointFieldGoalsAttempted||'-';
      let h3M=hStats.threePointFieldGoalsMade||'-', h3A=hStats.threePointFieldGoalsAttempted||'-';
      let aFouls=aStats.fouls||aStats.totalFouls||'0', hFouls=hStats.fouls||hStats.totalFouls||'0';

      if (isLive) { checkQuarterEnd(gid, aA, per, a3P, a3M, a3A, gLabel); checkQuarterEnd(gid, hA, per, h3P, h3M, h3A, gLabel); }

      let aLeaders=[], hLeaders=[];
      (comp.competitors||[]).forEach(c => {
        (c.leaders||[]).forEach(cat => {
          if (cat.name==='points'||cat.displayName==='Points') {
            (cat.leaders||[]).forEach(l => {
              const e = { name: l.athlete?.shortName||l.athlete?.displayName||'?', pts: parseFloat(l.value)||0, team: c.homeAway==='away'?aA:hA };
              if (c.homeAway==='away') aLeaders.push(e); else hLeaders.push(e);
            });
          }
        });
      });

      let signals=[], signalLevel=0;
      let thesis = { game: gLabel, aTeam: aA, hTeam: hA, aScore: aS, hScore: hS, per, clk, detail, criteria: {}, betSide: '', betLogic: '', signals: [] };

      if (isLive) {
        // 3PT CHECK
        const chk3 = (p,m,a,t,side) => {
          const pn=parseFloat(p), an=parseInt(a), mn=parseInt(m);
          if (pn>=50&&an>=8) {
            signals.push({type:'3pt',text:`${t} ${pn.toFixed(0)}% from 3 (${mn}/${an}) - UNSUSTAINABLE`,level:2});
            sig3++;
                  fire3PTAlert(t, pn.toFixed(0), mn, an, gLabel, per, clk); hotTeams++;
            thesis.criteria[`3pt_${side}`] = {met:true, strong:true, label:`${t} 3PT: ${pn.toFixed(0)}% (${mn}/${an})`, detail:`NBA avg is 36.5%. Shooting ${pn.toFixed(0)}% on ${an} attempts is 2+ std deviations above mean. This rate will regress ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ teams shooting 50%+ from 3 in a half sustain it only ~12% of games. The lead they built on 3PT scoring is inflated.`, value:`${pn.toFixed(0)}% on ${an} att`};
            return true;
          } else if (pn>=45&&an>=6) {
            signals.push({type:'3pt',text:`${t} ${pn.toFixed(0)}% from 3 (${mn}/${an}) - elevated`,level:1});
            warmTeams++;
            thesis.criteria[`3pt_${side}`] = {met:true, strong:false, label:`${t} 3PT: ${pn.toFixed(0)}% (${mn}/${an})`, detail:`Elevated but not extreme. Watch for further increase.`, value:`${pn.toFixed(0)}% on ${an} att`, warn:true};
          } else {
            thesis.criteria[`3pt_${side}`] = {met:false, label:`${t} 3PT: ${pn?pn.toFixed(0):'0'}%`, detail:`Normal shooting range, no 3PT regression signal.`, value:'Normal'};
          }
          return false;
        };
        const a3Hot = chk3(a3P,a3M,a3A,aA,'away'), h3Hot = chk3(h3P,h3M,h3A,hA,'home');

        // STAR PACE CHECK (60% threshold)
        const cM = parseFloat(clk?.split(':')[0]||12), cS = parseFloat(clk?.split(':')[1]||0);
        const gMins = (per-1)*12 + (12-cM-cS/60), gPct = Math.min(gMins/48,1);
        let starColdTeams = {};
        [...aLeaders,...hLeaders].forEach(leader => {
          const star = state.stars.find(s => leader.name.toLowerCase().includes(s.name.split(' ').pop().toLowerCase()) && s.team===leader.team);
          if (star) {
            const exp = getExpectedByTime(star.ppg, gMins);
            const pr = exp>0 ? leader.pts/exp : 1;
            const side = leader.team===aA?'away':'home';
            const oppSide = side==='away'?'home':'away';
            if (pr<0.6 && gPct>=0.2 && per<=3) {
              let ctx = per===1?` Q1 exp: ${getQ1Expected(star.ppg).toFixed(0)}`:per===2?` Half exp: ${getHalfExpected(star.ppg).toFixed(0)}`:'';
              signals.push({type:'star',text:`${leader.name} ${leader.pts}pts (exp ~${exp.toFixed(0)}, threshold ${(exp*0.6).toFixed(0)}).${ctx} MR candidate.`,level:2});
              sigStar++;
                fireStarColdAlert(leader, star, gMins, per, clk, gLabel, pr);
              starColdTeams[leader.team] = leader.name;
              thesis.criteria[`star_${oppSide}`] = {met:true, strong:true, label:`Opponent Star Cold: ${leader.name}`, detail:`${leader.name} averages ${star.ppg} PPG. At Q${per} ${clk}, expected ~${exp.toFixed(0)} pts but only has ${leader.pts}. That's ${(pr*100).toFixed(0)}% of pace (<60% threshold). Stars at this pace typically score 4-8 pts above current rate by game end ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ the market hasn't priced this bounce-back yet. Live ML is too favorable to the OTHER side.`, value:`${leader.pts}/${exp.toFixed(0)} pts (${(pr*100).toFixed(0)}%)`};
            } else if (pr<0.75 && gPct>=0.2) {
              signals.push({type:'star',text:`${leader.name} ${leader.pts}pts, behind ${star.ppg} PPG pace (exp ~${exp.toFixed(0)})`,level:1});
              thesis.criteria[`star_${oppSide}`] = {met:true, strong:false, label:`Opponent Star Below Pace: ${leader.name}`, detail:`${leader.name} (${star.ppg} PPG) has ${leader.pts} pts vs ${exp.toFixed(0)} expected. Below pace but not at critical 60% threshold yet.`, value:`${(pr*100).toFixed(0)}% pace`, warn:true};
            }
          }
        });

        // LEAD DURABILITY (PAINT vs 3PT)
        const aDur = analyzeScoringDurability(aA, aS, a3M, hS);
        const hDur = analyzeScoringDurability(hA, hS, h3M, aS);
        if (aDur.fragile) {
          signals.push({type:'paint',text:`${aA} lead built on 3PT (${aDur.pct3.toFixed(0)}% of pts from 3). Fragile - expect regression.`,level:2});
          sigFragile++;
          thesis.criteria['paint_away'] = {met:true, strong:true, label:`${aA} Lead Built on 3PT`, detail:`${aDur.pct3.toFixed(0)}% of ${aA}'s scoring is from 3-pointers (threshold: 42%). Leads built on 3PT shooting are fragile because 3PT% regresses toward 36.5%. If those 3s stop falling, their lead evaporates. Paint-heavy scoring is far more sustainable ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ paint points convert at ~60% vs 3PT at ~36%.`, value:`${aDur.pct3.toFixed(0)}% from 3PT`};
        } else {
          thesis.criteria['paint_away'] = {met:false, label:`${aA} Scoring Balance`, detail:`${aA} scoring is balanced or paint-heavy. Lead is durable.`, value: aS>0?`${aDur.pct3.toFixed(0)}% from 3PT`:'N/A'};
        }
        if (hDur.fragile) {
          signals.push({type:'paint',text:`${hA} lead built on 3PT (${hDur.pct3.toFixed(0)}% of pts from 3). Fragile - expect regression.`,level:2});
          sigFragile++;
          thesis.criteria['paint_home'] = {met:true, strong:true, label:`${hA} Lead Built on 3PT`, detail:`${hDur.pct3.toFixed(0)}% of ${hA}'s scoring is from 3-pointers (threshold: 42%). Same logic ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ 3PT-dependent leads are fragile. Market often overweights the current scoreboard without considering HOW the points were scored.`, value:`${hDur.pct3.toFixed(0)}% from 3PT`};
        } else {
          thesis.criteria['paint_home'] = {met:false, label:`${hA} Scoring Balance`, detail:`${hA} scoring is balanced or paint-heavy. Lead is durable.`, value: hS>0?`${hDur.pct3.toFixed(0)}% from 3PT`:'N/A'};
        }

        // FOUL ANALYSIS
        const aFoul = analyzeTeamFouls(aFouls, per, clk);
        const hFoul = analyzeTeamFouls(hFouls, per, clk);
        if (aFoul.highFouls) {
          signals.push({type:'foul',text:`${aA} high foul rate (${aFoul.fouls} fouls, ${aFoul.perQtr}/qtr). Opponent getting bonus FTs - inflated scoring.`,level:1});
          thesis.criteria['foul_away'] = {met:true, strong:false, label:`${aA} High Foul Rate`, detail:`${aA} fouling at ${aFoul.perQtr}/qtr (${aFoul.fouls} total). This sends ${hA} to the FT line more ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ inflating ${hA}'s score with easy points. But fouls regress as coaches adjust. ${hA}'s lead may be partly built on FT volume that won't sustain.`, value:`${aFoul.perQtr}/qtr`, warn:true};
        }
        if (hFoul.highFouls) {
          signals.push({type:'foul',text:`${hA} high foul rate (${hFoul.fouls} fouls, ${hFoul.perQtr}/qtr). Opponent getting bonus FTs - inflated scoring.`,level:1});
          thesis.criteria['foul_home'] = {met:true, strong:false, label:`${hA} High Foul Rate`, detail:`${hA} fouling at ${hFoul.perQtr}/qtr (${hFoul.fouls} total). ${aA} getting bonus FT trips that inflate their scoring. Foul rates typically normalize as game progresses.`, value:`${hFoul.perQtr}/qtr`, warn:true};
        }

        // COMBINED - build thesis per side
        const has3=signals.some(s=>s.type==='3pt'&&s.level===2);
        const hasStar=signals.some(s=>s.type==='star'&&s.level===2);
        const hasPaint=signals.some(s=>s.type==='paint'&&s.level===2);
        if ((has3&&hasStar)||(has3&&hasPaint)||(hasStar&&hasPaint)) { signalLevel=2; sigCombined++; }
        else if (has3||hasStar||hasPaint) signalLevel=1;

        // Determine bet side and build thesis logic
        if (signalLevel >= 1) {
          // Figure out which team to bet ON (the one that benefits from regression)
          let betTeam = '', fadeTeam = '', reasons = [];
          const a3Data = thesis.criteria['3pt_away'], h3Data = thesis.criteria['3pt_home'];
          const aPaint = thesis.criteria['paint_away'], hPaint = thesis.criteria['paint_home'];

          // Score each side: who has unsustainable advantages?
          let awayFade=0, homeFade=0;
          if (a3Data?.met && a3Data?.strong) awayFade++;  // away shooting too hot = fade away
          if (h3Data?.met && h3Data?.strong) homeFade++;  // home shooting too hot = fade home
          if (aPaint?.met && aPaint?.strong && aS > hS) awayFade++;  // away lead is fragile
          if (hPaint?.met && hPaint?.strong && hS > aS) homeFade++;  // home lead is fragile
          // Star cold on a team = bet ON that team (star will regress up)
          if (starColdTeams[aA]) homeFade++;  // away star cold = away bounces back = fade home
          if (starColdTeams[hA]) awayFade++;  // home star cold = home bounces back = fade away

          if (awayFade > homeFade) { betTeam = hA; fadeTeam = aA; }
          else if (homeFade > awayFade) { betTeam = aA; fadeTeam = hA; }
          else if (awayFade > 0) { betTeam = hA; fadeTeam = aA; }
          else { betTeam = aS < hS ? aA : hA; fadeTeam = aS < hS ? hA : aA; }

          // Build the narrative
          if (a3Data?.met && a3Data?.strong) reasons.push(`${aA} is shooting an unsustainable ${a3Data.value} from 3 ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ this will cool off`);
          if (h3Data?.met && h3Data?.strong) reasons.push(`${hA} is shooting an unsustainable ${h3Data.value} from 3 ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ this will cool off`);
          if (starColdTeams[aA]) reasons.push(`${starColdTeams[aA]} (${aA}) is ice cold ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ star players at <60% pace bounce back ~78% of the time`);
          if (starColdTeams[hA]) reasons.push(`${starColdTeams[hA]} (${hA}) is ice cold ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ star players at <60% pace bounce back ~78% of the time`);
          if (aPaint?.met && aPaint?.strong && aS > hS) reasons.push(`${aA}'s lead is fragile ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ ${aPaint.value} scoring from 3PT`);
          if (hPaint?.met && hPaint?.strong && hS > aS) reasons.push(`${hA}'s lead is fragile ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ ${hPaint.value} scoring from 3PT`);
          if (thesis.criteria['foul_away']?.met) reasons.push(`${aA} fouling heavy (${thesis.criteria['foul_away'].value}) ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ opponent FT inflation`);
          if (thesis.criteria['foul_home']?.met) reasons.push(`${hA} fouling heavy (${thesis.criteria['foul_home'].value}) ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ opponent FT inflation`);

          const strongCriteria = Object.values(thesis.criteria).filter(c => c.met && c.strong).length;
          const allCriteria = Object.values(thesis.criteria).filter(c => c.met).length;

          thesis.betSide = betTeam;
          thesis.fadeSide = fadeTeam;
          thesis.betLogic = reasons.join('. ') + '.';
          thesis.confidence = strongCriteria >= 3 ? 'high' : strongCriteria >= 2 ? 'high' : allCriteria >= 2 ? 'medium' : 'low';
          thesis.strongCount = strongCriteria;
          thesis.totalMet = allCriteria;
          thesis.signals = signals;
          thesis.signalLevel = signalLevel;
          gameTheses.push(thesis);
        }
      }

      const cc = signalLevel===2?'signal-fire':signalLevel===1?'signal-warn':'';
      const hc = isLive?'game-card-header live-pulse':'game-card-header';

      const bar3 = (p,m,a,t) => {
        const v=parseFloat(p)||0, bc=v>=50?'hot':v>=36.5?'normal':'cold';
        return `<div class="stat-bar-row"><span class="stat-bar-label">${t} 3PT%</span><div class="stat-bar-track"><div class="stat-bar-fill ${bc}" style="width:${Math.min(v,100)}%">${v.toFixed(0)}%</div><div class="stat-bar-avg" style="left:36.5%" data-label="36.5%"></div></div><span class="stat-bar-value">${m||'-'}/${a||'-'}</span></div>`;
      };

      // Durability bars
      let durabilityHTML = '';
      if (isLive && (aS > 0 || hS > 0)) {
        const aDur = analyzeScoringDurability(aA, aS, a3M, hS);
        const hDur = analyzeScoringDurability(hA, hS, h3M, aS);
        const durBar = (team, dur) => {
          if (dur.pct3 <= 0) return '';
          const cls = dur.durability;
          const w = Math.min(dur.pct3, 100);
          const col = dur.fragile ? 'var(--red)' : dur.durable ? 'var(--teal)' : 'var(--blue)';
          return `<div class="durability-bar ${cls}"><span>${team}</span><div class="durability-meter"><div class="durability-meter-fill" style="width:${w}%;background:${col};"></div></div><span>${dur.label}</span></div>`;
        };
        durabilityHTML = durBar(aA, aDur) + durBar(hA, hDur);
      }

      // Foul info
      let foulHTML = '';
      if (isLive) {
        const aF = analyzeTeamFouls(aFouls, per, clk);
        const hF = analyzeTeamFouls(hFouls, per, clk);
        if (parseInt(aFouls) > 0 || parseInt(hFouls) > 0) {
          foulHTML = `<div class="stat-bar-row"><span class="stat-bar-label">Fouls</span><span style="flex:1;font-size:11px;">${aA}: ${aFouls}${aF.highFouls?' &#x26A0;':''} | ${hA}: ${hFouls}${hF.highFouls?' &#x26A0;':''}</span></div>`;
        }
      }

      cards += `<div class="game-card ${cc}"><div class="${hc}"><span>${isLive?'LIVE':'UPCOMING'} ${detail}</span><span>${new Date(event.date).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span></div>
        <div class="game-card-body">
          <div class="game-teams"><div class="team-block"><div class="team-name">${aA}</div><div class="team-record">${aRec}</div><div class="team-score">${isLive?aS:'-'}</div></div><div class="vs-block"><div class="vs-text">@</div>${isLive?`<div class="game-period">Q${per} ${clk}</div>`:''}</div><div class="team-block"><div class="team-name">${hA}</div><div class="team-record">${hRec}</div><div class="team-score">${isLive?hS:'-'}</div></div></div>
          ${isLive?`<div class="stat-bars">${bar3(a3P,a3M,a3A,aA)}${bar3(h3P,h3M,h3A,hA)}${foulHTML}${aLeaders.length?`<div class="stat-bar-row"><span class="stat-bar-label">${aA} pts</span><span style="flex:1;font-weight:700;font-size:11px;">${aLeaders[0]?.name}: ${aLeaders[0]?.pts}</span></div>`:''}${hLeaders.length?`<div class="stat-bar-row"><span class="stat-bar-label">${hA} pts</span><span style="flex:1;font-weight:700;font-size:11px;">${hLeaders[0]?.name}: ${hLeaders[0]?.pts}</span></div>`:''}</div>${durabilityHTML}`:''}
          ${signals.length?`<div class="signal-panel ${signalLevel===2?'fire':signalLevel===1?'strong':''}"><div class="signal-title ${signalLevel===2?'fire':'warn'}">${signalLevel===2?'STRONG EDGE SIGNAL':'DEVELOPING SIGNAL'}</div>${signals.map(s=>`<div class="signal-detail">${s.level===2?'&#x1F525;':'&#x26A0;&#xFE0F;'} ${s.text}</div>`).join('')}${signalLevel===2?`<div style="margin-top:5px;"><button class="btn btn-orange btn-sm" onclick="openLogModal('${gLabel}','Live ML','Mean Reversion')">Log Bet</button></div>`:''}</div>`:''}
          ${isLive&&!signals.length?`<div style="text-align:center;padding:4px;font-size:10px;color:var(--gray);">No signals</div>`:''}
        </div></div>`;

      // 3PT TRACKER CARD
      if (isLive) {
        const ap=parseFloat(a3P)||0, hp=parseFloat(h3P)||0;
        const aHot=ap>=50&&parseInt(a3A)>=8, hHot=hp>=50&&parseInt(h3A)>=8;
        const aWarm=ap>=45&&parseInt(a3A)>=6&&!aHot, hWarm=hp>=45&&parseInt(h3A)>=6&&!hHot;
        const cb=(aHot||hHot)?'hot-card':(aWarm||hWarm)?'warm-card':'';
        const qBoxes=(t,p,m,a)=>{const pv=parseFloat(p)||0,mv=parseInt(m)||0,av=parseInt(a)||0;let b='';for(let q=1;q<=4;q++){const act=q===per,past=q<per;if(past||act){const hc2=pv>=50&&av>=8&&act?'hot-q':act?'active-q':'';b+=`<div class="qtr-box ${hc2}"><div class="qtr-label">Q${q}${act?' *':''}</div><div class="qtr-value ${act&&pv>=50?'hot-val':'normal-val'}">${act?pv.toFixed(0)+'%':'-'}</div><div class="qtr-detail">${act?mv+'/'+av:'done'}</div></div>`;}else b+=`<div class="qtr-box"><div class="qtr-label">Q${q}</div><div class="qtr-value normal-val">-</div><div class="qtr-detail">-</div></div>`;}return b;};
        const tRow=(t,p,m,a,hot,warm)=>{const badge=hot?'<span class="signal-badge signal-fire">UNSUSTAINABLE</span>':warm?'<span class="signal-badge signal-moderate">ELEVATED</span>':'<span class="signal-badge signal-none">Normal</span>';return `<div style="margin-bottom:12px;"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;"><span style="font-weight:800;font-size:14px;color:var(--navy);">${t}</span>${badge}</div>${bar3(p,m,a,t)}<div class="qtr-grid">${qBoxes(t,p,m,a)}</div></div>`;};
        tpCards+=`<div class="three-pt-card ${cb}"><div class="three-pt-card-header"><span>${gLabel}</span><span>Q${per} ${clk}</span></div><div class="three-pt-card-body">${tRow(aA,a3P,a3M,a3A,aHot,aWarm)}${tRow(hA,h3P,h3M,h3A,hHot,hWarm)}${(aHot||hHot)?`<div style="text-align:center;margin-top:6px;"><button class="btn btn-purple btn-sm" onclick="openLogModal('${gLabel}','3PT Reg','3PT Regression')">Log 3PT Bet</button></div>`:''}</div></div>`;
      }
    }

    grid.innerHTML = cards || `<div class="empty-state" style="grid-column:1/-1;"><p>No games.</p></div>`;
    tpGrid.innerHTML = tpCards || `<div class="empty-state" style="grid-column:1/-1;"><p>No live games.</p></div>`;

    // Update counts
    document.getElementById('live-3pt-signals').textContent = sig3;
    document.getElementById('live-star-signals').textContent = sigStar;
    document.getElementById('live-combined-signals').textContent = sigCombined;
    document.getElementById('live-fragile-leads').textContent = sigFragile;
    document.getElementById('threept-hot-count').textContent = hotTeams;
    document.getElementById('threept-warm-count').textContent = warmTeams;

    const totalSigs = sig3+sigStar+sigFragile;
    if (totalSigs>0) { document.getElementById('live-badge').style.display='inline'; document.getElementById('live-badge').textContent=totalSigs; }
    else document.getElementById('live-badge').style.display='none';
    if (hotTeams>0) { document.getElementById('threept-badge').style.display='inline'; document.getElementById('threept-badge').textContent=hotTeams; }

    // EDGE THESIS PANEL
    const etc = document.getElementById('edgeThesisContainer');
    const etCards = document.getElementById('edgeThesisCards');
    if (gameTheses.length > 0) {
      etc.classList.add('active');
      document.getElementById('thesisCount').textContent = gameTheses.length + ' LIVE';
      // Sort by confidence (high first)
      gameTheses.sort((a,b) => (b.strongCount||0) - (a.strongCount||0));
      etCards.innerHTML = gameTheses.map(t => {
        const confDots = Array.from({length:5}, (_,i) => {
          if (i < t.strongCount) return `<div class="conf-dot lit-red"></div>`;
          if (i < t.totalMet) return `<div class="conf-dot lit"></div>`;
          return `<div class="conf-dot"></div>`;
        }).join('');
        const confCls = t.confidence==='high'?'high':t.confidence==='medium'?'medium':'low';
        const scoreDiff = Math.abs(t.aScore - t.hScore);
        const leading = t.aScore > t.hScore ? t.aTeam : t.hScore > t.aScore ? t.hTeam : 'TIE';
        const trailing = t.aScore > t.hScore ? t.hTeam : t.hScore > t.aScore ? t.aTeam : '';

        // Build criteria cards
        const criteriaKeys = ['3pt_away','3pt_home','star_away','star_home','paint_away','paint_home','foul_away','foul_home'];
        const criteriaHTML = criteriaKeys.map(k => {
          const c = t.criteria[k];
          if (!c) return '';
          const cls = c.met ? (c.strong ? 'met' : 'met') : 'not-met';
          const icon = c.met ? (c.strong ? '&#x1F525;' : '&#x26A0;&#xFE0F;') : '&#x2796;';
          const valCls = c.met ? (c.strong ? '' : 'warn') : 'neg';
          return `<div class="criteria-item ${cls}">
            <span class="criteria-check">${icon}</span>
            <div class="criteria-text">
              <span class="criteria-label">${c.label}</span>
              <span class="criteria-value ${valCls}">${c.value}</span>
              <span class="criteria-detail">${c.detail}</span>
            </div>
          </div>`;
        }).filter(Boolean).join('');

        return `<div class="thesis-card">
          <div class="thesis-game-bar">
            <div>
              <div class="thesis-game-label">${t.game}</div>
              <div class="thesis-game-period">Q${t.per} ${t.clk} ${leading!=='TIE'?`| ${leading} leads by ${scoreDiff}`:'| Tied'}</div>
            </div>
            <div class="thesis-confidence">
              <div class="conf-meter">${confDots}</div>
              <span class="conf-label ${confCls}">${t.totalMet} criteria met</span>
            </div>
          </div>
          <div class="thesis-body">
            <div class="thesis-bet-line">
              <div>
                <div class="thesis-bet-action">BET ${t.betSide} ML</div>
                <div class="thesis-bet-side">Fade ${t.fadeSide} ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ ${t.confidence.toUpperCase()} confidence</div>
              </div>
              <button class="btn btn-orange btn-sm" onclick="openLogModal('${t.game}','Live ML','Mean Reversion')">Log This Bet</button>
            </div>
            <div class="thesis-logic">
              <div class="thesis-logic-title">Why This Is an Edge</div>
              <div class="thesis-logic-text">${t.betLogic} The live moneyline is priced on the current score, but the current score is built on unsustainable conditions. When those conditions normalize (3PT% drops, star heats up, paint scoring returns to mean), the true probability shifts toward ${t.betSide}. The market is slow to reprice these temporary swings ÃÂÃÂ¢ÃÂÃÂÃÂÃÂ that's the edge.</div>
            </div>
            <div class="thesis-criteria">${criteriaHTML}</div>
            <div class="thesis-actions">
              <span style="font-size:10px;color:#666;">${t.aTeam} ${t.aScore} - ${t.hScore} ${t.hTeam} | ${t.detail}</span>
              <button class="btn btn-green btn-sm" onclick="openLogModal('${t.game}','Live ML','Mean Reversion')">Log Bet</button>
            </div>
          </div>
        </div>`;
      }).join('');
    } else { etc.classList.remove('active'); etCards.innerHTML = ''; }

    updateStarTracker(events);

  } catch (err) {
    setConnStatus('error');
    if (state.consecutiveErrors < 3) {
      grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><p style="color:var(--orange);">Connection issue (${err.message}). Retrying next cycle...</p></div>`;
    } else {
      grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><p style="color:var(--red);">Connection failed ${state.consecutiveErrors}x. ESPN may be rate-limiting. Wait 30s then try again.</p></div>`;
    }
  }
}

// ==================== STAR TRACKER ====================
function updateStarTracker(events) {
  const tb = document.getElementById('live-star-status');
  let rows = '';
  for (const ev of events) {
    if (ev.status?.type?.state !== 'in') continue;
    const comp = ev.competitions?.[0]; if (!comp) continue;
    const per=ev.status?.period||1, clk=ev.status?.displayClock||'12:00';
    const cM=parseFloat(clk?.split(':')[0]||12), cS=parseFloat(clk?.split(':')[1]||0);
    const gMins=(per-1)*12+(12-cM-cS/60), gPct=Math.min(gMins/48,1);
    for (const team of (comp.competitors||[])) {
      const tA=team.team?.abbreviation||'';
      const aT=comp.competitors?.find(c=>c.homeAway==='away'), hT=comp.competitors?.find(c=>c.homeAway==='home');
      const gl=`${aT?.team?.abbreviation||''} @ ${hT?.team?.abbreviation||''}`;
      for (const cat of (team.leaders||[])) {
        if (cat.name!=='points') continue;
        for (const l of (cat.leaders||[])) {
          const nm=l.athlete?.shortName||l.athlete?.displayName||'';
          const pts=parseFloat(l.value)||0;
          const star=state.stars.find(s=>nm.toLowerCase().includes(s.name.split(' ').pop().toLowerCase())&&s.team===tA);
          if (!star) continue;
          const exp=getExpectedByTime(star.ppg,gMins), pr=exp>0?(pts/exp*100):100;
          const q1E=getQ1Expected(star.ppg), hE=getHalfExpected(star.ppg);
          let q1T='-';
          if (per>=2) q1T=`${q1E.toFixed(1)} exp`;
          else if (per===1) { const p=q1E>0?(pts/q1E*100):100; q1T=`<span style="color:${p<60?'var(--red)':p<80?'var(--orange)':'var(--green)'};font-weight:700;">${p.toFixed(0)}%</span> of ${q1E.toFixed(1)}`; }
          let hT2='-';
          if (per>=3) hT2=`${hE.toFixed(1)} exp`;
          else if (per===2||(per===1&&gMins>0)) { const p=hE>0?(pts/hE*100):100; hT2=`<span style="color:${p<60?'var(--red)':p<80?'var(--orange)':'var(--green)'};font-weight:700;">${p.toFixed(0)}%</span> of ${hE.toFixed(1)}`; }
          const fc=pr<60?'var(--red)':pr<80?'var(--orange)':'var(--green)';
          const sig=pr<60&&gPct>=0.2&&per<=3?'<span class="signal-badge signal-fire">COLD - BET</span>':pr<75?'<span class="signal-badge signal-moderate">Below Pace</span>':'<span class="signal-badge signal-none">On Pace</span>';
          rows+=`<tr class="star-row"><td><strong>${nm}</strong><br><span style="font-size:9px;color:var(--gray);">${star.ppg} PPG</span></td><td>${gl}</td><td style="font-size:16px;font-weight:800;">${pts}</td><td>${q1T}</td><td>${hT2}</td><td><div class="pace-indicator"><div class="pace-fill" style="width:${Math.min(pr,100)}%;background:${fc};"></div></div> ${pr.toFixed(0)}%</td><td>Q${per} ${clk}</td><td>${sig}</td></tr>`;
        }
      }
    }
  }
  tb.innerHTML = rows || '<tr><td colspan="8" class="empty-state">No tracked stars in live games.</td></tr>';
}

// ==================== STAR DB ====================
function renderStarDB() {
  const tb = document.getElementById('star-db-body');
  tb.innerHTML = state.stars.map((s,i) => {
    const q1=getQ1Expected(s.ppg), h=getHalfExpected(s.ppg);
    return `<tr><td><strong>${s.name}</strong></td><td>${s.team}</td><td>${s.ppg}</td><td>${q1.toFixed(1)}</td><td>${h.toFixed(1)}</td><td>&lt;${(q1*0.6).toFixed(0)} Q1, &lt;${(h*0.6).toFixed(0)} half</td><td><button class="btn btn-red btn-sm" onclick="removeStar(${i})">X</button></td></tr>`;
  }).join('');
}
function addStar() {
  const n=document.getElementById('add-star-name').value.trim(), t=document.getElementById('add-star-team').value.trim().toUpperCase(), p=parseFloat(document.getElementById('add-star-ppg').value);
  if (!n||!t||isNaN(p)) { alert('Fill all fields'); return; }
  state.stars.push({name:n,team:t,ppg:p}); localStorage.setItem('starPlayers',JSON.stringify(state.stars)); renderStarDB();
  document.getElementById('add-star-name').value=''; document.getElementById('add-star-team').value=''; document.getElementById('add-star-ppg').value='';
}
function removeStar(i) { state.stars.splice(i,1); localStorage.setItem('starPlayers',JSON.stringify(state.stars)); renderStarDB(); }

// ==================== BET LOG ====================
function openLogModal(g,p,s) { document.getElementById('modal-game').value=g; document.getElementById('modal-price').value=p; document.getElementById('modal-strategy').value=s; document.getElementById('modal-side').value=''; document.getElementById('modal-notes').value=''; document.getElementById('logModal').classList.add('active'); }
function closeModal() { document.getElementById('logModal').classList.remove('active'); }
function confirmLogBet() {
  state.betLog.push({date:new Date().toLocaleDateString(),strategy:document.getElementById('modal-strategy').value,game:document.getElementById('modal-game').value,side:document.getElementById('modal-side').value,price:document.getElementById('modal-price').value,units:parseFloat(document.getElementById('modal-units').value),result:'Pending',profit:0,notes:document.getElementById('modal-notes').value,id:Date.now()});
  localStorage.setItem('betLog',JSON.stringify(state.betLog)); renderBetLog(); closeModal();
}
function renderBetLog() {
  const tb=document.getElementById('bet-log-body');
  if (!state.betLog.length) { tb.innerHTML='<tr><td colspan="9" class="empty-state">No bets logged.</td></tr>'; updateLogStats(); return; }
  tb.innerHTML = state.betLog.slice().reverse().map(b => {
    const rc=b.result==='W'?'move-up':b.result==='L'?'move-down':'';
    const sb=b.strategy==='3PT Regression'?'signal-purple':b.strategy==='Paint Durability'?'signal-teal':b.strategy==='Foul Trouble'?'signal-moderate':'signal-strong';
    return `<tr><td>${b.date}</td><td><span class="signal-badge ${sb}">${b.strategy}</span></td><td>${b.game}</td><td>${b.side}</td><td>${b.price}</td><td>${b.units}</td><td class="${rc}">${b.result}</td><td class="${b.profit>=0?'move-up':'move-down'}">${b.profit>0?'+':''}${b.profit.toFixed(2)}u</td><td>${b.result==='Pending'?`<button class="btn btn-green btn-sm" onclick="resolveBet(${b.id},'W')">W</button> <button class="btn btn-red btn-sm" onclick="resolveBet(${b.id},'L')">L</button> <button class="btn btn-outline btn-sm" onclick="resolveBet(${b.id},'Push')">P</button>`:''}</td></tr>`;
  }).join('');
  updateLogStats();
}
function resolveBet(id,r) {
  const b=state.betLog.find(x=>x.id===id); if(!b) return; b.result=r;
  if(r==='W'){const p=parseInt(b.price)||-110; b.profit=p>0?b.units*(p/100):b.units*(100/Math.abs(p));}
  else if(r==='L') b.profit=-b.units; else b.profit=0;
  localStorage.setItem('betLog',JSON.stringify(state.betLog)); renderBetLog();
}
function updateLogStats() {
  const r=state.betLog.filter(b=>b.result!=='Pending'), w=r.filter(b=>b.result==='W').length, t=r.length;
  const nu=r.reduce((s,b)=>s+b.profit,0), tr=r.reduce((s,b)=>s+b.units,0);
  document.getElementById('log-total').textContent=state.betLog.length;
  document.getElementById('log-winrate').textContent=t>0?(w/t*100).toFixed(1)+'%':'-';
  document.getElementById('log-net-units').textContent=(nu>=0?'+':'')+nu.toFixed(2);
  document.getElementById('log-net-units').className=`stat-value ${nu>=0?'green':'red'}`;
  document.getElementById('log-roi').textContent=tr>0?(nu/tr*100).toFixed(1)+'%':'-';
  let streak=0,st='';
  for(let i=r.length-1;i>=0;i--){if(i===r.length-1){st=r[i].result;streak=1;}else if(r[i].result===st)streak++;else break;}
  const se=document.getElementById('log-streak');
  if(streak>0){se.textContent=streak+st;se.className=`stat-value ${st==='W'?'green':st==='L'?'red':''}`;}else se.textContent='-';
}
function clearLog(){if(confirm('Clear ALL?')){state.betLog=[];localStorage.setItem('betLog','[]');renderBetLog();}}
function exportLog(){
  if(!state.betLog.length){alert('No bets');return;}
  const h='Date,Strategy,Game,Side,Price,Units,Result,Profit,Notes\n';
  const r=state.betLog.map(b=>`${b.date},${b.strategy},"${b.game}",${b.side},${b.price},${b.units},${b.result},${b.profit.toFixed(2)},"${b.notes}"`).join('\n');
  const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([h+r],{type:'text/csv'}));a.download=`NBA_Edge_${new Date().toISOString().slice(0,10)}.csv`;a.click();
}

// ==================== BANKROLL ====================
function updateBankroll() {
  const s=parseFloat(document.getElementById('bankroll-start').value)||0, c=parseFloat(document.getElementById('bankroll-current').value)||0;
  state.bankroll={start:s,current:c}; localStorage.setItem('bankroll',JSON.stringify(state.bankroll));
  const u=c*0.01;
  document.getElementById('br-unit').textContent=u>0?'$'+u.toFixed(0):'-';
  document.getElementById('br-max').textContent=u>0?'$'+(u*2).toFixed(0):'-';
  document.getElementById('br-daily').textContent=u>0?'$'+(u*5).toFixed(0):'-';
  const pl=c-s;
  document.getElementById('br-pl').textContent=s>0?(pl>=0?'+':'')+`$${pl.toFixed(0)}`:'-';
  document.getElementById('br-pl').className=`stat-value ${pl>=0?'green':'red'}`;
  const pct=s>0?(pl/s*100):0;
  document.getElementById('br-pl-pct').textContent=s>0?(pct>=0?'+':'')+pct.toFixed(1)+'%':'-';
  document.getElementById('br-pl-pct').className=`stat-value ${pct>=0?'green':'red'}`;
}
document.getElementById('logModal').addEventListener('click',function(e){if(e.target===this)closeModal();});


// ==================== SOUND SYSTEM (Web Audio API) ====================
let audioCtx = null;
let soundEnabled = JSON.parse(localStorage.getItem('soundEnabled') || 'true');

function initAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

function playAlertSound(type) {
  if (!soundEnabled) return;
  const ctx = initAudio();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain);
  gain.connect(ctx.destination);
  
  if (type === 'cold') {
    // Descending alert: urgent but not annoying
    osc.type = 'sine';
    osc.frequency.setValueAtTime(880, ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.15);
    osc.frequency.setValueAtTime(880, ctx.currentTime + 0.2);
    osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.35);
    gain.gain.setValueAtTime(0.3, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.5);
  } else if (type === 'hot3pt') {
    // Triple beep for 3PT
    osc.type = 'square';
    gain.gain.setValueAtTime(0, ctx.currentTime);
    for (let i = 0; i < 3; i++) {
      const t = ctx.currentTime + i * 0.15;
      osc.frequency.setValueAtTime(660, t);
      gain.gain.setValueAtTime(0.2, t);
      gain.gain.setValueAtTime(0, t + 0.08);
    }
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.5);
  } else if (type === 'combined') {
    // Epic alert for combined signals
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(440, ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.2);
    osc.frequency.setValueAtTime(440, ctx.currentTime + 0.25);
    osc.frequency.exponentialRampToValueAtTime(1100, ctx.currentTime + 0.45);
    gain.gain.setValueAtTime(0.2, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.6);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.6);
  }
}

function toggleSound() {
  soundEnabled = !soundEnabled;
  localStorage.setItem('soundEnabled', JSON.stringify(soundEnabled));
  const btn = document.getElementById('soundToggle');
  btn.classList.toggle('active', soundEnabled);
  btn.innerHTML = soundEnabled ? '&#x1F50A; Sound' : '&#x1F507; Muted';
  if (soundEnabled) playAlertSound('cold'); // test beep
}

// Init sound button state
document.addEventListener('DOMContentLoaded', function() {
  const btn = document.getElementById('soundToggle');
  if (btn) {
    btn.classList.toggle('active', soundEnabled);
    btn.innerHTML = soundEnabled ? '&#x1F50A; Sound' : '&#x1F507; Muted';
  }
});

// ==================== SCENARIO ALERT SYSTEM ====================
let activeAlerts = [];
let alertIdCounter = 0;
const ALERT_HISTORY = JSON.parse(localStorage.getItem('alertHistory') || '[]');

function showScenarioAlert(data) {
  // data: { player, team, game, quarter, clock, currentPts, expectedPts, ppg, pacePercent, type, signals }
  const panel = document.getElementById('scenario-alert-panel');
  if (!panel) return;
  
  const id = 'alert-' + (++alertIdCounter);
  const paceColor = data.pacePercent < 50 ? '#4fc3f7' : data.pacePercent < 75 ? 'var(--orange)' : 'var(--green)';
  const paceFill = Math.min(data.pacePercent, 100);
  const deficit = data.expectedPts - data.currentPts;
  const deficitText = deficit > 0 ? deficit.toFixed(1) + ' pts behind' : Math.abs(deficit).toFixed(1) + ' pts ahead';
  
  let badge = 'COLD ALERT';
  let badgeBg = 'var(--red)';
  let soundType = 'cold';
  if (data.type === 'hot3pt') { badge = '3PT FIRE'; badgeBg = 'var(--orange)'; soundType = 'hot3pt'; }
  else if (data.type === 'combined') { badge = 'MULTI-SIGNAL'; badgeBg = 'linear-gradient(90deg, var(--red), var(--orange))'; soundType = 'combined'; }
  else if (data.type === 'fragile') { badge = 'FRAGILE LEAD'; badgeBg = '#e91e63'; soundType = 'cold'; }
  
  const q1Exp = (data.ppg * 0.25).toFixed(1);
  const halfExp = (data.ppg * 0.5).toFixed(1);
  const periodLabel = data.quarter <= 2 ? 'Q' + data.quarter : data.quarter <= 4 ? 'Q' + data.quarter : 'OT';
  const periodExp = data.quarter === 1 ? q1Exp : data.quarter === 2 ? halfExp : data.expectedPts.toFixed(1);
  const periodExpLabel = data.quarter === 1 ? 'Q1 Exp' : data.quarter === 2 ? 'Half Exp' : 'Exp Now';
  
  const alertEl = document.createElement('div');
  alertEl.className = 'scenario-alert';
  alertEl.id = id;
  alertEl.innerHTML = `
    <button class="alert-dismiss" onclick="dismissAlert('${id}')">&times;</button>
    <div class="alert-header">
      <span class="alert-badge" style="background:${badgeBg};">${badge}</span>
      <span class="alert-game-time">${data.game} &bull; ${periodLabel} ${data.clock}</span>
    </div>
    <div class="alert-player">${data.player}</div>
    <div class="alert-team">${data.team} &bull; ${data.ppg} PPG season avg</div>
    <div class="alert-stats">
      <div class="alert-stat">
        <div class="alert-stat-label">Current</div>
        <div class="alert-stat-value cold">${data.currentPts}</div>
      </div>
      <div class="alert-stat">
        <div class="alert-stat-label">${periodExpLabel}</div>
        <div class="alert-stat-value neutral">${periodExp}</div>
      </div>
      <div class="alert-stat">
        <div class="alert-stat-label">Pace</div>
        <div class="alert-stat-value ${data.pacePercent < 60 ? 'cold' : data.pacePercent < 80 ? 'neutral' : 'hot'}">${data.pacePercent.toFixed(0)}%</div>
      </div>
    </div>
    <div class="alert-pace-bar">
      <div class="alert-pace-fill" style="width:${paceFill}%;background:${paceColor};"></div>
      <div class="alert-pace-marker" style="left:60%;" title="60% threshold"></div>
    </div>
    <div class="alert-verdict">
      <strong>${deficitText}</strong> expected pace at ${periodLabel} ${data.clock}. 
      Stars below 60% pace at this point bounce back ~78% of the time. 
      <strong>Mean reversion candidate ÃÂ¢ÃÂÃÂ live ML is mispriced.</strong>
    </div>
    <div class="alert-action">
      <button class="btn btn-orange btn-sm" onclick="openLogModal('${data.game}','Live ML','Mean Reversion')">Log Bet</button>
      <button class="btn btn-outline btn-sm" onclick="dismissAlert('${id}')">Dismiss</button>
    </div>
  `;
  
  panel.appendChild(alertEl);
  activeAlerts.push(id);
  
  // Play sound
  playAlertSound(soundType);
  
  // Auto-dismiss after 30s
  setTimeout(() => dismissAlert(id), 30000);
  
  // Save to history
  ALERT_HISTORY.unshift({ ...data, time: new Date().toISOString() });
  if (ALERT_HISTORY.length > 50) ALERT_HISTORY.length = 50;
  localStorage.setItem('alertHistory', JSON.stringify(ALERT_HISTORY));
}

function dismissAlert(id) {
  const el = document.getElementById(id);
  if (el) {
    el.style.animation = 'alertSlideIn 0.3s ease-in reverse';
    setTimeout(() => el.remove(), 300);
  }
  activeAlerts = activeAlerts.filter(a => a !== id);
}

// ==================== DEMO SIMULATION MODE ====================
function runDemoScenario() {
  // Initialize audio on user gesture
  initAudio();
  
  const scenarios = [
    {
      player: 'Jalen Brunson', team: 'NYK ÃÂ¢ÃÂÃÂ¢ New York Knicks', game: 'NYK @ BOS',
      quarter: 2, clock: '1:01', currentPts: 3, ppg: 26.3,
      expectedPts: 14.5, pacePercent: 20.7, type: 'cold',
      signals: ['Star at 21% pace', 'Mean reversion candidate']
    },
    {
      player: 'Shai Gilgeous-Alexander', team: 'OKC ÃÂ¢ÃÂÃÂ¢ Oklahoma City Thunder', game: 'OKC @ LAL',
      quarter: 1, clock: '2:30', currentPts: 2, ppg: 32.2,
      expectedPts: 7.7, pacePercent: 26.0, type: 'cold',
      signals: ['Star at 26% Q1 pace', 'Below 60% threshold']
    },
    {
      player: 'Luka Doncic', team: 'DAL ÃÂ¢ÃÂÃÂ¢ Dallas Mavericks', game: 'DAL @ MIA',
      quarter: 2, clock: '5:45', currentPts: 4, ppg: 28.1,
      expectedPts: 11.7, pacePercent: 34.2, type: 'combined',
      signals: ['Star cold + MIA shooting 55% from 3', 'Multi-signal edge']
    }
  ];
  
  // Pick a random scenario or cycle through them
  const idx = Math.floor(Math.random() * scenarios.length);
  const s = scenarios[idx];
  
  showScenarioAlert(s);
}



// ==================== HOOK: FIRE SCENARIO ALERTS FROM LIVE DATA ====================
// Override the original signal detection to also trigger scenario alerts
const _origShowQuarterToast = showQuarterToast;
const _firedAlerts = new Set(); // prevent duplicate alerts per game refresh

function fireStarColdAlert(leader, star, gMins, per, clk, gLabel, paceRatio) {
  const alertKey = star.name + '_' + per + '_' + Math.floor(gMins);
  if (_firedAlerts.has(alertKey)) return;
  _firedAlerts.add(alertKey);
  // Clear old keys every 5 minutes
  setTimeout(() => _firedAlerts.delete(alertKey), 300000);
  
  const exp = getExpectedByTime(star.ppg, gMins);
  showScenarioAlert({
    player: leader.name,
    team: star.team,
    game: gLabel,
    quarter: per,
    clock: clk,
    currentPts: leader.pts,
    expectedPts: exp,
    ppg: star.ppg,
    pacePercent: paceRatio * 100,
    type: 'cold',
    signals: ['Star at ' + (paceRatio * 100).toFixed(0) + '% pace', 'Below 60% threshold']
  });
}

function fire3PTAlert(teamAbbr, pct, made, att, gLabel, per, clk) {
  const alertKey = teamAbbr + '_3pt_' + per;
  if (_firedAlerts.has(alertKey)) return;
  _firedAlerts.add(alertKey);
  setTimeout(() => _firedAlerts.delete(alertKey), 300000);
  
  showScenarioAlert({
    player: teamAbbr + ' Team',
    team: teamAbbr + ' shooting unsustainably hot',
    game: gLabel,
    quarter: per,
    clock: clk,
    currentPts: parseFloat(pct),
    expectedPts: 36.5,
    ppg: 36.5,
    pacePercent: (parseFloat(pct) / 36.5) * 100,
    type: 'hot3pt',
    signals: [teamAbbr + ' at ' + pct + '% from 3 (' + made + '/' + att + ')']
  });
}

</script>
</body>
</html>

